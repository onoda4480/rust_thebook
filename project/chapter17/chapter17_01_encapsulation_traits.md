# Chapter 17-1: ã‚«ãƒ—ã‚»ãƒ«åŒ–ã¨ãƒˆãƒ¬ã‚¤ãƒˆ

## ã‚«ãƒ—ã‚»ãƒ«åŒ–

### ã‚«ãƒ—ã‚»ãƒ«åŒ–ã¨ã¯ï¼Ÿ

**ã€Œä¸­èº«ã‚’éš ã—ã¦ã€å¤–ã‹ã‚‰ã¯ä½¿ã„æ–¹ã ã‘è¦‹ã›ã‚‹ã€**

---

### AveragedCollection ã®ä¾‹

```rust
pub struct AveragedCollection {
    list: Vec<i32>,      // â† privateï¼ˆå¤–ã‹ã‚‰è¦‹ãˆãªã„ï¼‰
    average: f64,        // â† privateï¼ˆå¤–ã‹ã‚‰è¦‹ãˆãªã„ï¼‰
}

impl AveragedCollection {
    pub fn add(&mut self, value: i32) {
        self.list.push(value);
        self.update_average();
    }

    pub fn average(&self) -> f64 {
        self.average
    }

    fn update_average(&mut self) {  // â† private
        let sum: i32 = self.list.iter().sum();
        self.average = sum as f64 / self.list.len() as f64;
    }
}
```

---

### ã‚«ãƒ—ã‚»ãƒ«åŒ–ã®åˆ©ç‚¹

#### 1. è‡ªç”±ã«æ”¹å–„ã§ãã‚‹

```rust
// Before
list: Vec<i32>

// Afterï¼ˆå†…éƒ¨å®Ÿè£…ã‚’å¤‰æ›´ï¼‰
list: HashSet<i32>  // é‡è¤‡ã‚’è‡ªå‹•é™¤å»

// å¤–ã®ã‚³ãƒ¼ãƒ‰ï¼šå½±éŸ¿ãªã—ï¼
```

#### 2. å£Šã‚Œã«ãã„

```rust
// ã‚«ãƒ—ã‚»ãƒ«åŒ–ãªã—ã ã¨...
collection.list.push(100);
// average ãŒæ›´æ–°ã•ã‚Œãªã„ï¼ãƒã‚°ï¼ğŸ’¥

// ã‚«ãƒ—ã‚»ãƒ«åŒ–ã™ã‚‹ã¨
collection.add(100);
// update_average() ãŒè‡ªå‹•ã§å‘¼ã°ã‚Œã‚‹ âœ…
```

---

## ãƒˆãƒ¬ã‚¤ãƒˆ

### ãƒˆãƒ¬ã‚¤ãƒˆã¨ã¯ï¼Ÿ

**å…±é€šã®æŒ¯ã‚‹èˆã„ã‚’æŠ½è±¡åŒ–ã™ã‚‹**

```rust
pub trait Draw {
    fn draw(&self);  // ãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚·ã‚°ãƒãƒãƒ£ã ã‘
}
```

---

### ãƒˆãƒ¬ã‚¤ãƒˆã®å®šç¾© vs å®Ÿè£…

#### ãƒˆãƒ¬ã‚¤ãƒˆå®šç¾©ï¼ˆå¥‘ç´„æ›¸ï¼‰

```rust
pub trait Draw {
    fn draw(&self);  // â† ã‚»ãƒŸã‚³ãƒ­ãƒ³ï¼ˆæœ¬ä½“ãªã—ï¼‰
}
```

**å½¹å‰²:** ã€Œã“ã®æ©Ÿèƒ½ã‚’æŒã¤ã¹ãã€ã¨ã„ã†ç´„æŸ

---

#### ãƒˆãƒ¬ã‚¤ãƒˆå®Ÿè£…ï¼ˆå®Ÿéš›ã®ä¸­èº«ï¼‰

```rust
impl Draw for Button {
    fn draw(&self) {
        // å®Ÿéš›ã«ãƒœã‚¿ãƒ³ã‚’æç”»ã™ã‚‹ã‚³ãƒ¼ãƒ‰
        println!("ãƒœã‚¿ãƒ³ã‚’æç”»");
    }
}

impl Draw for SelectBox {
    fn draw(&self) {
        // å®Ÿéš›ã«ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’æç”»ã™ã‚‹ã‚³ãƒ¼ãƒ‰
        println!("ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’æç”»");
    }
}
```

**å½¹å‰²:** ç´„æŸã‚’å®Ÿéš›ã«å®ˆã‚‹ï¼ˆå®Ÿè£…ã™ã‚‹ï¼‰

---

### ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå®Ÿè£…

```rust
pub trait Summary {
    fn author(&self) -> String;  // å¿…é ˆ

    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå®Ÿè£…
    fn summarize(&self) -> String {
        format!("(Read more from {}...)", self.author())
    }
}
```

**åˆ©ç‚¹:** å¿…é ˆãƒ¡ã‚½ãƒƒãƒ‰ã ã‘å®Ÿè£…ã™ã‚Œã°ã€ä»–ã¯è‡ªå‹•çš„ã«ä½¿ãˆã‚‹

---

## ãƒˆãƒ¬ã‚¤ãƒˆã®ç›®çš„

### ãªãœãƒˆãƒ¬ã‚¤ãƒˆãŒå¿…è¦ï¼Ÿ

#### æ™®é€šã® impl ã ã‘ã ã¨

```rust
struct Button;
impl Button {
    fn draw_button(&self) { /* ... */ }
}

struct SelectBox;
impl SelectBox {
    fn draw_select(&self) { /* ... */ }
}

// ãƒ¡ã‚½ãƒƒãƒ‰åãŒãƒãƒ©ãƒãƒ© â†’ çµ±ä¸€çš„ã«æ‰±ãˆãªã„
```

---

#### ãƒˆãƒ¬ã‚¤ãƒˆã‚ã‚Šã ã¨

```rust
trait Draw {
    fn draw(&self);  // çµ±ä¸€ã•ã‚ŒãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
}

impl Draw for Button {
    fn draw(&self) { /* ... */ }
}

impl Draw for SelectBox {
    fn draw(&self) { /* ... */ }
}

// ç•°ãªã‚‹å‹ã‚’ã¾ã¨ã‚ã¦æ‰±ãˆã‚‹
let components: Vec<Box<dyn Draw>> = vec![
    Box::new(Button { }),
    Box::new(SelectBox { }),
];

for c in &components {
    c.draw();  // åŒã˜ãƒ¡ã‚½ãƒƒãƒ‰å
}
```

---

## ã¾ã¨ã‚

| æ¦‚å¿µ | èª¬æ˜ |
|------|------|
| **ã‚«ãƒ—ã‚»ãƒ«åŒ–** | å®Ÿè£…ã®è©³ç´°ã‚’éš ã™ |
| **ãƒˆãƒ¬ã‚¤ãƒˆ** | å…±é€šã®æŒ¯ã‚‹èˆã„ã‚’æŠ½è±¡åŒ– |
| **ãƒˆãƒ¬ã‚¤ãƒˆå®šç¾©** | ã€Œä½•ã‚’ã™ã‚‹ã‹ã€ã ã‘æ±ºã‚ã‚‹ |
| **ãƒˆãƒ¬ã‚¤ãƒˆå®Ÿè£…** | ã€Œã©ã†ã‚„ã‚‹ã‹ã€ã¯å„å‹ãŒæ±ºã‚ã‚‹ |
| **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå®Ÿè£…** | å…±é€šå‡¦ç†ã‚’æä¾›ã§ãã‚‹ |

**é‡è¦:** ãƒˆãƒ¬ã‚¤ãƒˆ = å‹ã‚’è¶…ãˆãŸå…±é€šã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
